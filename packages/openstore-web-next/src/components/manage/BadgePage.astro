---
import BadgeSelect from "@/components/BadgeSelect";
import ManageHeader from "@/components/manage/ManageHeader.astro";
import { AppManageSchema } from "@/lib/schema";
import ManageError from "./ManageError.astro";

export type Props = {
  id: string;
};

const { id } = Astro.props;
const apikey = Astro.cookies.get("apikey")!.value;
const appResponse = await fetch(`${import.meta.env.PUBLIC_API_URL}api/v3/manage/${id}?apikey=${apikey}`);

const app = appResponse.status === 200 ? await appResponse.json().then(({ data }) => AppManageSchema.parse(data)) : undefined;
---

{app ? (
  <ManageHeader app={app} breadcrumb="Badge" />

  <section class="section mb-8 grow">
    <h2 class="text-2xl">Badge</h2>

    <div class="w-full mt-4">
      <BadgeSelect appId={app.id} client:load />
    </div>
  </section>
) : (
  <ManageError status={appResponse.status} />
)}
