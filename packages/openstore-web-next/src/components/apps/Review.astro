---
import { RatingType, type ReviewData } from "@/lib/schema";

import SvgThumbsUp from "@/components/icons/ThumbsUp";
import SvgNeutral from "@/components/icons/Neutral";
import SvgHappy from "@/components/icons/Happy";
import SvgThumbsDown from "@/components/icons/ThumbsDown";
import SvgBuggy from "@/components/icons/Buggy";
import { initializeI18N } from "@/lib/i18n";
import { t } from "i18next";

await initializeI18N(Astro.currentLocale);

const ICON_MAP = {
  [RatingType.THUMBS_UP]: SvgThumbsUp,
  [RatingType.HAPPY]: SvgHappy,
  [RatingType.NEUTRAL]: SvgNeutral,
  [RatingType.THUMBS_DOWN]: SvgThumbsDown,
  [RatingType.BUGGY]: SvgBuggy,
};

const dateFormatter = new Intl.DateTimeFormat("en", {
  // TODO get lang from the URL
  dateStyle: "medium",
});

export type Props = {
  review: ReviewData;
};

const { review } = Astro.props;
const Icon = ICON_MAP[review.rating];
---

<div class="flex flex-row">
  <div class="mt-4 mr-4">
    <Icon />
  </div>

  <div>
    <p class="text-lg font-bold">{review.author}</p>
    <p class="text-sm text-gray-600">
      {t("Reviwed %{date} for version %{version}").replace("%{date}", dateFormatter.format(review.date)).replace("%{version}", review.version)}
    </p>
    <p>{review.body}</p>
  </div>
</div>
