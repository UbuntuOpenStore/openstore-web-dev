---
import BaseLayout from "@/layouts/BaseLayout.astro";
import SearchApps from "@/components/SearchApps";
import CategoryList from "@/components/CategoryList.astro";
import { CategoriesSchema, type CategoryData } from "@/lib/schema";
import { initializeI18N } from "@/lib/i18n";
import { t } from "i18next";

export type Props = {
  category: CategoryData;
};

export async function getStaticPaths() {
  const response = await fetch(`${import.meta.env.PUBLIC_API_URL}api/v3/categories?all=true`); // TODO send the language from the URL
  const { data } = await response.json();
  const categories = CategoriesSchema.parse(data);

  return categories.map((category) => {
    return {
      params: {
        category: category.slug,
      },
      props: {
        category,
      },
    };
  });
}

await initializeI18N("en_US");

const { category } = Astro.props;
---

<BaseLayout title="OpenStore" pageTitle={t("Categories") + " | OpenStore"} description={t("The open source app store for Ubuntu Touch")}>
  <section class="grow flex flex-row">
    <CategoryList class="mx-12 w-96 mb-2 hidden md:block" />

    <div class="w-full">
      <SearchApps category={category.category} categoryName={category.translation} client:only="preact" />
    </div>
  </section>
</BaseLayout>
